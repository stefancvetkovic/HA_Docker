alias: Play spotify on multiple speakers
icon: "mdi:party-popper"
description: 'Play spotify on multiple speakers'
fields:
  source_avr:
    description: 'The avr zone/speaker that will reproduce sound'
    example: media_player.avr_zone1, media_player.avr_zone2
  source:
    description: 'Selected source for ceiling zone speakers'
    example: HEOS Music
  volume_avr:
    description: "sets the volume on the avr"
    example: '0.6'
  speakers:
    description: 'Media player(s) that will be playing - ONLY IF ZONE2'
    example: media_player.bedroom_ceiling_speaker, media_player.hallway_ceiling_speaker, media_player.bathroom_ceiling_speaker, media_player.office, media_player.office_shelf_speakers
  volume_speaker:
    description: "sets the volume on the speaker"
    example: '0.52'

sequence:
#First, turn on and set up HEOS on Denon AVR
  - service: media_player.turn_on
    data:
      entity_id: media_player.avr_zone1, media_player.avr_zone2
  - delay: 00:00:03
  - service: media_player.volume_set
    data:
      entity_id: media_player.avr_zone2
      volume_level: 0.5
  - service: media_player.volume_set
    data:
      entity_id: media_player.avr_zone1
      volume_level: 0.5
  - service: media_player.select_source
    data:
      entity_id: media_player.avr_zone1, media_player.avr_zone2
      source: HEOS Music

# Second, turn on all media_players (multiple zone speakers) and set the appropriete source
  - service: media_player.turn_on
    data:
      entity_id: "{{ speakers }}"

  - service: media_player.select_source
    data:
      entity_id: "{{ speakers }}"
      source: "{{ source }}"

  - service: media_player.volume_set
    data:
      entity_id:  "{{ speakers }}"
      volume_level: 0.4

  - choose:
    - conditions:
        - condition: template
          value_template: >
            {{not is_state('media_player.spotify_stefan', 'playing')}}
      sequence:
        # - service: spotcast.start
        #   data:
        #     spotify_device_id: "aa6a0bf7c5f107cba747e35dad2347b1f4030ae8"
        #     device_name: Denon AVR-X2400H
        #     uri: >
        #       {% set playlists = ['spotify:playlist:37i9dQZF1DX9loJQLuEvap','spotify:playlist:37i9dQZF1DX4UtSsGT1Sbe','spotify:playlist:37i9dQZF1DX0s5kDXi1oC5', 'spotify:playlist:37i9dQZF1DX4o1oenSJRJd','spotify:playlist:37i9dQZF1DX5Ejj0EkURtP','spotify:playlist:37i9dQZF1DWSqmBTGDYngZ']%}
        #       {{ playlists | random}}
        #     #force_playback: true
        #     random_song: true
        #     #repeat: track
        #     shuffle: true
        #     offset: 1

  # - service: media_player.volume_set
  #   data:
  #     entity_id: media_player.avr_zone1
  #     volume_level: "{{ volume_avr}}"

