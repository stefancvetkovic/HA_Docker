alias: Turn off all lights and devices
sequence:
  - service: script.turn_off
    entity_id: 
      - script.play_notification
      - script.play_notification_everywhere
  - service: script.turn_on
    entity_id: script.play_notification_everywhere
    data:
      variables:
        source: "Primary Chromecast"
        volume: "0.3"
        custom_message: "Attention: Lights and media will be turned off in a few seconds."

  - wait_template: "{{ is_state('script.play_notification_everywhere','off') }}"
    timeout: '00:03:00'
    continue_on_timeout: 'true'

  #Kill all the lights
  - service: light.turn_off
    entity_id: all

  - service: switch.turn_off
    entity_id: switch.bedroom_led_light_trafo

  - service: light.turn_on
    entity_id: light.wled_br_quad_master

  #Turn off all media players
  - service: media_player.turn_off
    entity_id: all


  - choose:
      - conditions:
        - condition: and
          conditions:
            - condition: template
              value_template: "{{ states('input_boolean.pet_mode') == 'on' }}"
            - condition: template
              value_template: "{{ states('binary_sensor.night_reworked') == 'on' }}"
            - condition: or
              conditions:
            - condition: template
              value_template: "{{ state_attr('cover.ds_s','current_position') < 50 and state_attr('cover.ds_l','current_position') < 50 and state_attr('cover.ds_d','current_position') < 50}}"
        sequence:
          - service: light.turn_on
            entity_id: light.hallway_bedroom_wall_light, light.livingroom_wled_above_tv, light.bedroom_left_lamp