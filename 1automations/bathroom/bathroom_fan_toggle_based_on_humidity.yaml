- alias: 'control fan by humidity'
  trigger:
    - platform: numeric_state
      entity_id: sensor.bathroom_thp_humidity
      above: 60  
    - platform: numeric_state
      entity_id: sensor.bathroom_thp_humidity
      below: 50  
  action:
    - service_template: >
        {% if states('sensor.bathroom_thp_humidity') | float >= 60 and states('light.bathroom_main_light') == 'on' %}
          switch.turn_on
        {% else %}
          switch.turn_off
        {% endif %}
      entity_id: switch.bathroom_fan